---
title: "Link types"
sidebar_position: 2
---

This section provides descriptions of different link types. Links
should be defined in workflows `links` field, and actions should in
workflows/scripts `actions` field. The main difference between them is
that action handlers need to be triggered separately (for example,
user click a button), links handlers will be triggered if any of its
input is changed.

Links and actions runtime creation is based on matching [Link Query
Language](./link-spec) or LQL for short. So until workflow state
satisfies matching rules, link will not be crated. If changes in the
current workflow break link matching rules, the link is destroyed.

### Common options

These options are avaliable for all links and actions types.

#### `id`

Should be unique on the same level.

#### `type`

There are several types of links/actions:

- `data`
- `validator`
- `meta`
- `selector`
- `funccall`
- `pipeline`

#### `from`

Describes link inputs via a [Link Query Language](./link-spec). Could
be either a LQL string or an array of 0 or more LQL strings. All from
LQL queries should have at least one match, otherwise a link will not
be created.

#### `to`

Describes link outputs via a [Link Query Language](./link-spec) Could
be either a LQL string or an array of 0 or more LQL strings. All to
LQL queries should have at least one match, otherwise a link will not
be created.

#### `handler`

A function that receives an object with a `controller` instance, which
type is base on link `type` field. Handler function might be async via
returning either a `Promise<void>` or an `Observable<void>`. No any
side effects that are made via controller methods are visible until
the handler finished. Controller must be the only way to read or write
state for any handler. Also handlers must not internally mutate
received states. If the same handler is triggered before a previous
invocation is finished, the previous one will be gracefully canceled
and no changes are applied. Handler is mandatory for all links and
actions, except for [data links](#data-links), where a [default
handler](#default-handler) might be used if non is provided.

#### `not`

_Optional_

Could be either a LQL string or an array of 0 or more
[LQL](./link-spec) strings. If all LQL queries match the link will not
be created. Queries are targeting script nodes or workflows.

#### `base`

_Optional_

Could be either a LQL string or an array of exactly 1
[LQL](./link-spec) string. Queries are targeting script nodes or
workflows. Used in [reference selectors](./link-spec).

#### `dataFrameMutations`

_Optional_

By default internal script io mutations will not trigger links,
however for DataFrames it is possible to configure such behavior. If
`true` is set all link DataFrame inputs mutations will trigger the
link handler. Also it is possible to narrow down by matched input LQL
names using an array of names.

#### `nodePriority`

_Optional_

Used to specify link running order if multiple links has the same link
output script node targets, links with a higher priority will run
before those with a lower one.

### Common controller methods

These options are avaliable for all controller types.

#### `getAll`

```
getAll<T = any>(name: string): T[] | undefined;
```

Receives an input query name. Returns an array of 1 or more matched
items or undefined.

#### `getFirst`

```
getFirst<T = any>(name: string): T | undefined;
```

Receives an input query name. Returns the first matched items or
undefined.

#### `getMatchedInputs`

```
getMatchedInputs(): Readonly<Set<string>>;
```

Returns a set of all matched input queries names. The set is ordered
based on DFS traversal, if query returns multiple matches, the
first one is used.

#### `getMatchedOutputs`

```
getMatchedOutputs(): Readonly<Set<string>>;
```

Returns a set of all matched outputs queries names. The set is ordered
based on DFS traversal, if query returns multiple matches, the
first one is used.

#### `getAdditionalParam`

```
getAdditionalParam(name: string): any | undefined;
```

Only used in actions, for passing additional parameters from
[validatators](#validators).


### Action options

These options are available for all action types.

#### `position`

Where to show action. Possible values are
- `buttons` action is show in workflow/script ui as a button
- `menu` action is show as menu item
- `none` action is not show on ui at all

(__TODO ui examples__)

#### `friendlyName`

_Optional_

UI friendly action name

#### `description`

_Optional_

Action description is show as a hover on ui.

#### `menuCategory`

_Optional_

Creates a separate menu with menuCategory name, if multiple actions
has the same menuCategory, they will be grouped together. Applicable
only for actions with position `menu`.

#### `confirmationMessage`

_Optional_

A confirmation dialog with this text will be shown before running the
action.


#### `icon`

_Optional_

Font awesome 5 icon to be shown as a part of UI action button.


### Data links

Workflow `links` items with a type field `data`. Are used to pass data
between scripts io. A script input should be a target of at most 1
data link output at the same time. Also script outputs should not be
data links outputs. The controller has the following additional
methods:

#### `setAll`

```
setAll<T = any>(name: string, state: T, restriction?: RestrictionType): void;
```

Receives an output query name, state and an optional restriction. Sets
all matched outputs to the specified state with the restriction. For
more details about restriction see [Consistency](#consistency).


### Default handler

For [data links](#data-links) it is possible to omit `hander` and use
a default one. For each LQL input query the first matched input is
passed to the corresponding by order LQL output. It is also possible
to configure restrictions, via

#### `defaultRestrictions`

If a string is used, all outputs will use the same restriction. If a
key-value object is used, outputs could have individual restrictions,
the default restriction could be set as `*` key.


### Consistency

For [data links](#data-links) a consistency mechanism is used. There
are several restriction types restricting a user's ability to edit
script inputs that were set by data link.

- `disabled` user is not allowed to edit input
- `restricted` user is allowed to edit an input, however changes will
  make input inconsistent
- `info` user is allowed to edit an input without make input
  inconsistent, however user changes are still tracked
- `none` no consistency is tracked at all, always set values directly
  to script io

Consistency is tracked based on the value, stored separately from a
script io.

If a script was never run in the current workflow instance, data links
just set data directly to scripts io. However, if a script was run,
links will not overwrite script io data, but rather only trigger
consistency changes.

__TODO__ ui consistency examples docs and link here


### Validators

Validators are used to validate inputs and have `validator`
type. Multiple validators can target the same script io, validation
results will be merged. There are several validation severity levels,
also it is possible to show user executable actions alongside text
messages.

Validators has the following additional configuration options:

#### `actions`

_Optional_

Could be either a LQL string or an array of multiple
[LQL](./link-spec) strings. Queries are targeting script nodes or
workflows. Actions descriptors could be retrieved using
[`getValidationAction`](#getvalidationaction) controller method and
later shown alongside validation results via
[`setValidation`](#setvalidation) controller method.


Validation controller has the following additional methods:

#### `setValidation`

```
setValidation(name: string, validation?: ValidationResult | undefined): void;
```

Sets validation data to an output query with the specified name. There
are several validations result type in `ValidationResult`:

- `errors` blocking running a script
- `warnings` non-blocking warnings
- `notifications` non-blocking suggestions

Each of those field could have an array of `Adives` items:

```
ActionItem {
  actionName: string;
  action: string;
  additionalParams?: Record<string, any>;
}

interface Advice {
  description: string;
  actions?: ActionItem[];
}
```

Where `description` is a validation message, `actionName` is a visible
action name, `action` is a result of
[`getValidationAction`](#getvalidationaction). `additionalParams`
could be access inside action controller via
[`getAdditionalParam`](#getadditionalparam).

__TODO: ui example__

#### `getValidationAction`

```
getValidationAction(id: string, actionId: string) : string | undefined;
```

Gets an action descriptor to be used in `ValidationResult`.

For validation of the current workflow structure itself use another
method described [here](./configuration#structurecheck).


### Metadata links

Metadata links are used for [viewers
hooks](./configuration#viewershook) and have a type `meta`. A script
input should be a target of at most 1 data link output at the same
time.

Meta controller has an additional method:

#### `setViewMeta`

```
setViewMeta(name: string, meta: any): void;
```

Sets metadata to an output query with the specified name.

It is possible to hide script inputs setting the following meta:
```
{ hidden: true }
```

For choice inputs (__TODO__: link to doc) it is possible to set items list:
```
{ items: ['one', 'two', 'three'] }
```


### Description links

Description links are used to gather workflow metadata and display it
on ui. They have type `selector`. They have script io as inputs, but
instead of targeting scripts in outputs, selectors will have the
following workflow/script nodes targets:

- `title` will change item name in the navigation tree, also used to
  set title when user saves a workflow
- `description` will be used to fill description when user saves a
  workflow
- `tags` will be used to fill tags when user saves a workflow. Note
  that tags here are completely unrelated to `PipelineConfiguration`
  ones. They tag a particular saved instance of a workflow.

Selector controller has an additional method:

```
setDescriptionItem(name: string, description: any): void;
```

Sets description to an output query with the specified name.


### Data actions

Triggered by a user and place inside `actions`, otherwise the same as
[data links](#data-links).


### FuncCall actions

Used to change underlying script node FuncCall, has a type
`funccall`. FuncCall must be of the same function. Targets script io
as inputs and script nodes as outputs. Controller has additional
methods:

#### `setFuncCall`

```
setFuncCall(name: string, state: DG.FuncCall): void;
```

Sets FuncCall to an output query with the specified name.


### Pipeline actions

Used to replace dynamic workflow content, has a type `pipeline`.
Targets script io as inputs and dynamic workflows as outputs.
Controller has additional methods:

#### `setPipelineState`

```
setPipelineState(name: any, state: PipelineInstanceConfig): void;
```

Sets state to an output query with the specified
name. `PipelineInstanceConfig` is a recursive type that should be
compatible with the current workflow configuration. Each item should
have a matching `id`, nested items are referenced in `steps`
regardless of a workflow type. For script nodes it is possible to
provide `initialValues` and `inputRestrictions`.


### Init hook

It is using `onInit` field instead of links and is triggered only once
when a workflow created. Usually is used to populate static
[states](./configuration#states). Otherwise the same as [data
links](#data-links).
