# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build & Development Commands

```bash
npm run build          # Full build: grok api && grok check --soft && webpack
npm run build-admetica # Webpack only (faster, skips API generation)
npm run test           # Run tests via grok test
npm run link-all       # Link local @datagrok-libraries/* dependencies for development
```

Publishing variants use `grok publish` to different environments:
- `debug-admetica` / `release-admetica` — default server
- `*-dev`, `*-local`, `*-local2` — dev/local environments

## Architecture

Admetica is a Datagrok platform package for ADMET (Absorption, Distribution, Metabolism, Excretion, Toxicity) property prediction on molecules. It has a TypeScript frontend and a Python/Docker backend.

### Frontend (TypeScript)

- **`src/package.ts`** — Entry point. All Datagrok-registered functions use decorators (`@grok.decorators.*`) for panels, menus, and top-level actions.
- **`src/package-api.ts`** — Auto-generated typed wrappers (do not edit manually; regenerated by `grok api` / `FuncGeneratorPlugin`).
- **`src/utils/admetica-utils.ts`** — Core logic: prediction orchestration, color coding, tooltips, pie chart config.
- **`src/utils/admetica-editor.ts`** — Tree-based dialog UI for selecting models and managing templates.
- **`src/utils/admetica-form.ts`** — Dynamic FormViewer layout generation based on selected properties.
- **`src/utils/constants.ts`** — TypeScript interfaces (`Model`, `Subgroup`, `Template`) and color mappings.
- **`src/viewers/cell-render-viewer.ts`** — Custom grid cell renderer for pie charts.
- **`src/utils/admetica-app.ts`** — Demo application view (extends `BaseViewApp`).

### Backend (Python/Docker)

- **`dockerfiles/Admetica.py`** — Prediction engine exposed as a container service.
- **`dockerfiles/constants.py`** — Large file (~330KB) with pre-trained model data.

### Data Files

- **`files/templates/`** — JSON templates for different prediction profiles, stored at `System:AppData/Admetica/templates` on the platform.
- **`files/form-layout.json`** — Form design configuration.
- **`files/demo_files/`** — Sample CSV data for demos.

## Tests

Tests are in `src/tests/admetica-tests.ts` using `@datagrok-libraries/test`. Categories:
- Container POST request tests
- Calculate dialog UI tests
- Single cell and benchmark (5000 molecules) prediction tests

Test entry point is `src/package-test.ts`.

## Webpack & TypeScript Config

- TypeScript: strict mode, ES6 target, ES2020 modules, decorators enabled.
- ESLint: Google style guide, 120 char max line length, 2-space indent.
- Webpack externals: `datagrok-api/*`, `openchemlib/full.js`, `rxjs`, `cash-dom`, `dayjs` are all external.
- Two entry points: `package.ts` (main) and `package-test.ts` (tests).
